<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇游戏：玩家 vs 电脑AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        canvas {
            border: 1px solid black;
            margin-top: 20px;
        }
        h1 {
            margin-top: 20px;
        }
        .game-over {
            font-size: 2em;
            color: red;
        }
        #startScreen, #endScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        #startScreen button, #endScreen button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
        #endScreen {
            display: none;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
        }
        #pauseScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            text-align: center;
        }
        #score {
            font-size: 20px;
            font-weight: bold;
        }
        .instructions {
            font-size: 18px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="startScreen">
        <h1>贪吃蛇游戏：玩家 vs 电脑AI</h1>
        <p class="instructions">欢迎来到贪吃蛇！</p>
        <p class="instructions">玩家蛇的颜色是绿色，AI蛇的颜色是蓝色。</p>
        <p class="instructions">使用箭头键或WASD控制玩家蛇，AI会自动移动。</p>
        <p class="instructions">快捷键：按"P"暂停游戏，按"R"重新开始游戏。</p>
        <button onclick="startGame()">开始游戏</button>
    </div>

    <canvas id="gameCanvas" width="800" height="800"></canvas>

    <div id="score">
        <p>玩家得分: <span id="playerScore">0</span></p>
        <p>AI得分: <span id="aiScore">0</span></p>
    </div>

    <div id="pauseScreen">
        <h2>游戏暂停</h2>
        <button onclick="resumeGame()">继续游戏</button>
        <button onclick="restartGame()">重新开始</button>
    </div>

    <div id="endScreen">
        <h1 id="endMessage">游戏结束</h1>
        <button onclick="restartGame()">重新开始</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const playerScoreDisplay = document.getElementById('playerScore');
        const aiScoreDisplay = document.getElementById('aiScore');
        const startScreen = document.getElementById('startScreen');
        const endScreen = document.getElementById('endScreen');
        const pauseScreen = document.getElementById('pauseScreen');

        // 游戏参数
        const gridSize = 20; // 每个方格的大小
        const tileCount = 40; // 网格大小 40x40
        const canvasWidth = gridSize * tileCount; // 800px
        const canvasHeight = gridSize * tileCount; // 800px
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        // 玩家和AI的蛇
        let playerSnake = [{x: 5, y: 5}];
        let aiSnake = [{x: 10, y: 10}];
        let playerDirection = 'RIGHT';
        let aiDirection = 'LEFT';

        // 游戏状态
        let gameOver = false;
        let aiGameOver = false;
        let playerLength = 1;
        let aiLength = 1;
        let playerScore = 0;
        let aiScore = 0;

        // 食物的位置
        let food = generateFood();

        // 游戏循环的速度
        let gameInterval;
        let playerInterval;
        let aiInterval;

        // 游戏开始
        function startGame() {
            startScreen.style.display = 'none'; // 隐藏开始界面
            resetGame(); // 重置游戏状态
            gameInterval = setInterval(gameLoop, 50); // 启动游戏循环
            playerInterval = setInterval(() => {
                if (!gameOver && !aiGameOver) {
                    movePlayer();
                }
            }, 200); // 玩家每0.2秒移动一次

            aiInterval = setInterval(() => {
                if (!gameOver && !aiGameOver) {
                    moveAI();
                }
            }, 250); // AI每0.25秒移动一次
        }

        // 游戏循环
        function gameLoop() {
            if (gameOver || aiGameOver) {
                showEndScreen();
                return;
            }

            // 清除画布
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // 更新玩家和AI蛇的位置
            updateSnake(playerSnake, playerDirection);
            updateSnake(aiSnake, aiDirection);

            // 检测碰撞
            checkCollision(playerSnake);
            checkCollision(aiSnake);

            // 检查蛇是否吃到食物
            if (checkFoodCollision(playerSnake)) {
                playerLength++;
                food = generateFood();
                playerScore++;
                updateScores();
            }
            if (checkFoodCollision(aiSnake)) {
                aiLength++;
                food = generateFood();
                aiScore++;
                updateScores();
            }

            // 渲染游戏
            drawSnake(playerSnake, 'green');
            drawSnake(aiSnake, 'blue');
            drawFood(food);
        }

        // 更新蛇的位置信息
        function updateSnake(snake, direction) {
            const head = { ...snake[0] };
            switch (direction) {
                case 'LEFT':
                    head.x--;
                    break;
                case 'RIGHT':
                    head.x++;
                    break;
                case 'UP':
                    head.y--;
                    break;
                case 'DOWN':
                    head.y++;
                    break;
            }

            // 在蛇头位置插入新的头部
            snake.unshift(head);

            // 删除尾部，保持蛇的长度
            if (snake.length > (snake === playerSnake ? playerLength : aiLength)) {
                snake.pop();
            }
        }

        // 检测蛇是否碰到墙壁或自己
        function checkCollision(snake) {
            const head = snake[0];
            // 撞到墙壁
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                if (snake === playerSnake) gameOver = true;
                else aiGameOver = true;
            }

            // 撞到自己
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    if (snake === playerSnake) gameOver = true;
                    else aiGameOver = true;
                }
            }
        }

        // 检查蛇是否吃到食物
        function checkFoodCollision(snake) {
            const head = snake[0];
            return head.x === food.x && head.y === food.y;
        }

        // 随机生成食物的位置
        function generateFood() {
            return {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
        }

        // 渲染蛇
        function drawSnake(snake, color) {
            snake.forEach(segment => {
                ctx.fillStyle = color;
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
            });
        }

        // 渲染食物
        function drawFood(food) {
            ctx.fillStyle = 'red';
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
        }

        // AI控制的贪吃蛇
        function moveAI() {
            const head = aiSnake[0];
            const possibleDirections = ['UP', 'DOWN', 'LEFT', 'RIGHT'];
            let bestDirection = null;
            let shortestDistance = Infinity;

            // 计算每个方向的距离，并选择最近的路径
            possibleDirections.forEach(direction => {
                const newHead = {...head};
                switch (direction) {
                    case 'LEFT': newHead.x--; break;
                    case 'RIGHT': newHead.x++; break;
                    case 'UP': newHead.y--; break;
                    case 'DOWN': newHead.y++; break;
                }

                // 计算此位置到食物的曼哈顿距离
                const distanceToFood = Math.abs(newHead.x - food.x) + Math.abs(newHead.y - food.y);

                // 选择最短的有效路径
                if (isValidMove(newHead) && distanceToFood < shortestDistance) {
                    shortestDistance = distanceToFood;
                    bestDirection = direction;
                }
            });

            if (bestDirection) {
                aiDirection = bestDirection;
            }
        }

        // 检查移动是否有效（不撞墙、不撞自己、不撞玩家的蛇）
        function isValidMove(newHead) {
            // 撞墙
            if (newHead.x < 0 || newHead.x >= tileCount || newHead.y < 0 || newHead.y >= tileCount) {
                return false;
            }

            // 撞到自己的身体
            for (let i = 0; i < aiSnake.length; i++) {
                if (newHead.x === aiSnake[i].x && newHead.y === aiSnake[i].y) {
                    return false;
                }
            }

            // 撞到玩家的身体
            for (let i = 0; i < playerSnake.length; i++) {
                if (newHead.x === playerSnake[i].x && newHead.y === playerSnake[i].y) {
                    return false;
                }
            }

            return true;
        }

        // 玩家控制的蛇
        function movePlayer() {
            updateSnake(playerSnake, playerDirection);
        }

        // 更新得分显示
        function updateScores() {
            playerScoreDisplay.textContent = `玩家得分: ${playerScore}`;
            aiScoreDisplay.textContent = `AI得分: ${aiScore}`;
        }

        // 显示游戏结束界面
        function showEndScreen() {
            clearInterval(gameInterval); // 停止游戏循环
            clearInterval(playerInterval); // 停止玩家移动
            clearInterval(aiInterval); // 停止AI移动
            endScreen.style.display = 'block'; // 显示结束界面
            const winner = gameOver ? "你输了" : "你赢了！";
            document.getElementById('endMessage').textContent = winner;
        }

        // 重新开始游戏
        function restartGame() {
            endScreen.style.display = 'none'; // 隐藏结束界面
            startScreen.style.display = 'block'; // 显示开始界面
            resetGame(); // 重置游戏状态
        }

        // 重置游戏状态
        function resetGame() {
            gameOver = false;
            aiGameOver = false;
            playerSnake = [{x: 5, y: 5}];
            aiSnake = [{x: 10, y: 10}];
            playerLength = 1;
            aiLength = 1;
            food = generateFood();
            playerDirection = 'RIGHT';
            aiDirection = 'LEFT';
            playerScore = 0;
            aiScore = 0;
            updateScores();
        }

        // 暂停游戏
        function pauseGame() {
            clearInterval(gameInterval);
            clearInterval(playerInterval);
            clearInterval(aiInterval);
            pauseScreen.style.display = 'block';
        }

        // 继续游戏
        function resumeGame() {
            gameInterval = setInterval(gameLoop, 50);
            playerInterval = setInterval(() => {
                if (!gameOver && !aiGameOver) {
                    movePlayer();
                }
            }, 200);
            aiInterval = setInterval(() => {
                if (!gameOver && !aiGameOver) {
                    moveAI();
                }
            }, 250);
            pauseScreen.style.display = 'none';
        }

        // 控制玩家蛇的移动，支持箭头键和WASD键
        document.addEventListener('keydown', (e) => {
            if (gameOver || aiGameOver) return;

            if ((e.key === 'ArrowLeft' || e.key === 'a') && playerDirection !== 'RIGHT') {
                playerDirection = 'LEFT';
            } else if ((e.key === 'ArrowRight' || e.key === 'd') && playerDirection !== 'LEFT') {
                playerDirection = 'RIGHT';
            } else if ((e.key === 'ArrowUp' || e.key === 'w') && playerDirection !== 'DOWN') {
                playerDirection = 'UP';
            } else if ((e.key === 'ArrowDown' || e.key === 's') && playerDirection !== 'UP') {
                playerDirection = 'DOWN';
            } else if (e.key === 'p') { // 按P暂停游戏
                pauseGame();
            }
        });

    </script>
</body>
</html>

    </script>
</body>
</html>
